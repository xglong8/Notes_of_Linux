# Linux 基础
参考：
* 《Linux 实用教程 第三版》 於岳
* 《鸟哥的Linux私房菜 基础学习篇》 鸟哥，王世江


## 一 Shell 基础
### 1. 获取帮助
 * man [option] [command]
 * whatis [command] = man -f [command]
 * [command] --help


### 2. 关闭和重启系统
 * shutdown [optione] [time] [warning]
   + 立即关闭/重启系统 shutdown -h/r now
   + 定时关闭/重启系统 shutdown -h/r 18:35/+45
 * halt = shutdown -h
 * reboot = shutdown -r


### 3. 常用快捷键
 * 控制：ctrl+l, ctrl+c,ctrl+z..
 * 光标：ctrl+a, ctrl+e, ctrl+u, ctrl+k,ctrl+w,ctrl+y,Alt+f,Alt+b
 * Tab 命令补全


### 4. 常用操作命令
 * whoami  列出当前用户
 * who 列出当前登陆系统的所有用户
 * which 查看命令：which ls
 * cd, mkdir, chmod
 * top,ps 查看进程，kill [PID]进程
 * alias/unalias 创建或查看/取消别名


### 5. 历史命令 ~/.bash_history
 * 运行历史命令
   + history [option]
   + history n 显示最近n个命令
   + history -c 清空历史记录
   + ！！运行上一个命令
   + ！6 运行第6个命令，！-6运行带倒数第6个命令
   + ！?gfd? 运行上一个包含gfd字符的命令
   + ！ls 运行上一个以ls开头的命令
   + ！ls:s/GF/D 运行上一个ls命令，并把期中的GF替换为D
   + ！$ 前一个命令的参数
 * 搜索历史命令
   + 上下箭头或ctrl+p/n
   + ctrl+r 向上搜索历史列表


### 6. 特殊字符
 * \` 命令替换，反引号内的命令先执行，并把结果传到引号外
 * \# 注释
 * & 后台进程
 * \\ 命令换行符
 * cat < temp 把键盘输入的内容写入temp文件，按ctrl+d结束
 * command  2> file 把运行命令时的错误信息写入或追加(2>>)到文件
 * command &> file  把运行命令时的输出信息及错误信息一起写入文件
 * $(command) 或 'command' 把命令运行结果作为一个新的参数或命令
 * ;(命令分隔符)，同时执行多个任务,command 1 ; command 2; ……
 * &&严格按先后顺序执行多个命令 command 1 && command 2 && ……
 * 其他：~, |, > ,>> , /, ?, \*, [a-z], [!0-9]


## 二 vim基础
### 命令模式
 * 光标移动
  + k上j下h左l右，nk上翻n行
  + H,M,L光标移动到屏幕顶端,中间，底端
  + ctrl+b/+f/+u/+d,往后/前翻一页/半页
  + 0/$光标移动到行首/尾
  + gg/G光标移动到文件首/尾
 * 删除
  + x/X删除光标所在位置/前的字符
  + nx/nX往后/前山删n个字符
  + dd删除当前行，ndd删除n行
  + dw/ndw删除一个/n个单词
  + d$删到行尾，d^删到行首
  + dgg,dG删到文件头/尾
 * 复制粘贴
  + yw, nyw复制到光标所在位置单词尾或到第n个单词尾
  + yy,nyy复制当前行或n行
  + y^,y$复制到行首/尾
  + p粘贴已复制的内容到当前位置
 * 撤销和重复
  + u撤消上一个操作，U撤消所有操作
  + .再次执行一次上一个操作
 * 查找匹配 /往后查找，?往前查找
 * 合并行 J,nJ合并当前行与下一行，或下n行
 * 保存和退出 ZZ保存退出，ZQ不保存操作退出


### 插入模式
 * 进入插入模式
  + i,a从光标所在位置前/后开始插入
  + I,A从光标所在行首/尾插入
  + o,O从光标所在下/上一新开一行插入


### 末行模式
1. 运行shell命令
 * : ! command
 * :r! command 把命令的输出从光标所在行开始插入
 * : n1, n2 w ! command 把n1行到n2行的内容作为命令的输入
 * :n 跳到第n行
2. 查找替换
 * :/str/ :?str? 向后或向前查找
 * :s/str1/str2/ 把光标所在行的下一个str1换成str2
 * :s/str1/str2/ 把光标所在行所有str1换成str2
 * :n1,n2 s/str1/str2/g 把n1行和n2之间的所有str1换成str2
 * :.$s/str1/str2/g 把当前位置到文件尾所有srt1替换掉
 * :%s/str1/str2/g 把文件当中所有str1替换掉
3. 删除
 * :n1,n2 d 从n1行删除到n2行
 * :.,$ d 从当前位置删除到文件尾
 * :/str1/, /str2/ d 从str1位置删除到str2位置
4. 复制和移动
 * :n1,n2 co n3 把n1到n2行复制后放到n3行之后
 * n1,n2 m n3 把n1到n2行内容移动到n3行之后
5. 设置vim
 * :set number显示箱行号
 * :set nonumber取消显示行号
 * :set readonly设置文件为只读状态避免错误改动
6. 保存和退出
 * :w [filename] 保存当前文件或另存为新文件
 * :q :wq (file name) : wq! (filename)
 * n1,n2 w filename 把n1行到n2行的内容保存到新文件
 * :1,. w filename :.,$ w filename
 * : r/e filename 打开/新建另一个文件
 * :/str/ w filename 把包含str的行写入文件
 * :/str1/,/str2/ w filename 把str1到str2之间的内容写到文件



## 三 目录和文件管理
### 1. Linux文件类型
Linux内核为每个新创建的文件分配一个inode(索引结点)号，文件属性保存在inode中，在访问文件时，inode被复制到内存里，从而实现文件的快速访问。
* 1.1 普通文件 用ls -lh 查看，属性第一个符号为"-",如'-xrwxrwxrw'
* 1.2 目录文件 属性第一个符号为'd'，表示directory
* 1.3 设备文件
  + 属性第一个符号为'b',表示block块设备文件，如磁盘
  + 属性第一个符号为'c',表示char字符设备文件，如打印机
* 1.4 管道文件
* 1.5 链接文件 属性第一个符号为'l'
  + 软链接/符号链接
    - 类似windows快捷方式，包含了源文件的路径名，可以是文件或目录
    - 可以链接不同文件系统中的文件
    - 修改链接文件会直接改变源文件
    - 删除链接文件，源文件不变
    - 删除源文件，链接文件断链
  + 硬链接
    - 硬链接是一个指针，指向文件的inode
    - 原则上不允许给目录创建硬链接，防止进入链接死循环
    - 只有在同一个文件系统才能创建硬链接
    - 删除源文件，硬链接文件不删除，系统把它当普通文件
    - 其他与软链接相同
  + 硬链接与软链接的区别
    - 硬链接记录的目标是inode，软链接记录的是目标的路径
    - 软链接像快捷方式，而硬链接像备份
    - 软链接可以跨分区链接，而硬链接由于inode的缘故，只能在本分区做链接
  + 创建链接文件 **ln [option] [original file] [link file]**
    - -i 删除文件前进行确认
    - -s 创建软链接
    - -d 创建指向目录的硬链接
    - -f 强行删除已存在的目标文件
    - -n 如果目标是一个链接至某目录的软链接，会把它当普通文件处理
    - -L 将硬链接创建为软链接使用
    - -t\<dir> 在指定的目录中创建链接
    - -v 链接前列出每个文件的名称

### 2. Linux 目录结构
* / 根目录
* /home 用户主目录
* /root root用户主目录
* /bin 包含用户常用命令文件
* /sbin 包含系统管理员和root用户常用命令文件
* /dev 包含大部分设备文件，如磁盘，光驱等
* /lib 包含系统共享文件和内核模块文件，/lib/modules存放核心可加载模块
* /lib64 包含64位版本的共享和内核模块文件
* /tmp 包含临时文件
* /media 系统自动挂载设备的挂载目录
* /mnt 手动挂载设备时的挂载目录
* /boot 包含系统内核文件和引导装载程序文件，如Grub
* /opt 第三方应用程序安装地址
* /var 存放不经常变化的数据，如系统日志，DNS数据库文件
* /etc 系统配置文件，建议修改之前先备份
* /usr 包含可以供所有用户使用的数据和程序
* /srv 存储服务启动后所需取用的资料目录
* /run 临时文件系统，一些程序或服务启动后，pid会被放置在该目录中
* /sys 包含所有检测到的硬件设置，它们会被转换成/dev目录中的设备文件
* /proc 虚拟文件系统，由内核在内存中产生，不存在磁盘当中，用来提供系统相关信息，如：
  + /proc/cpuinfo 计算机CPU信息
  + /proc/filesystems Linux文件系统信息
  + /proc/ioports 计算机I/O端口信息
  + /proc/version Linux 系统版本信息
  + /proc/meminfo 计算机内存信息
  + /proc/swaps 显示哪些swap被使用
  + /proc/net/dev 显示网络适配器及统计
  + /proc/mounts 显示已挂载的文件系统


### 3. 文件和目录操作
* 3.1 pwd 显示当前目录
* 3.2 cd [option] [dir] 更改当前目录
* 3.3 ls [option] [file\|dir] 列出目录和文件信息
  ls -lth README.md 命令显示的详细信息如下：

  **-rw-r--r--  1 usr  staff   7.2K 10 13 12:56 README.md**

  列数|描述
  :-:|:-
  第1列 | 第1个字符表示文件类型，2-4、5-7、8-10三段字符分别表示<br>用户所有者、群组和其他用户对此文件的权限，r-读，w-写，x-执行
  第2列 | 文件的链接数
  第3列 | 文件的用户所有者
  第4列 | 文件的群组所有者
  第5列 | 文件长度，即文件大小
  第6-8列 | 文件的更改时间(mtime),或最后访问时间(atime)
  第9列 | 文件名称


  + -h 以方便读的形式显示文件大小，如用B,KB,M,G等
  + -a 显示隐藏文件,-A显示隐藏文件，但是不显示.和..
  + -c 配合-lt,显示ctime（创建时间）并根据ctime排序
  + -d 对目录文件，只显示文件夹不显示其下文件和子目录
  + -F 对目录文件，显示其下子文件和目录
  + -i 在输出的第一列显示文件inode号
  + -l 用长格式显示文件详细信息
  + -r 逆序排列
  + -t 根据修改时间排序
  + -s 在第一列以块数形式显示每个文件分配的尺寸
  + -S 根据文件大小排序


* 3.4 **tree [dir]**
  + tree 显示文件和目录由根目录开始的树形结构


* 3.5 **touch [option] [file]**
  创建空文件或改变文件的访问时间(atime)和修改时间(mtime)
  + -a 只更改访问时间(atime)
  + -m 更改修改时间(mtime)
  + -c 修改时间时，如果文件不存在，不建立新的文件
  + -r\<file> 使用指定文件的时间属性而非当前时间
  + -d\<char> 使用指定字符串表示的时间而非当前时间
  + -t\<[[CC]YY]MMDDhhmm[.ss]> 使用指定格式的时间而非当前时间，如touch -c -t 09011830 file1


* 3.6 **mkdir [option] [dir]** 创建目录
  + -m 对新建立的目录设置权限，默认为755
  + -v 对创建的目录显示详细信息
  + -p 可以输入一个路径，若路径中某些目录不存在则自动创建那些目录，即一次创建多个目录


* 3.7 **rmdir [option] [dir]** 删除目录
  + -p 递归删除目录，当子目录被删除后，若父目录为空也一并删除
  + -v 输出处理的目录详情


* 3.8 **cp [option] [original file\|dir] [target file\|dir]** 复制文件和目录
  + -a 复制目录时保留链接和文件属性，并递归地复制目录
  + -d 保留链接
  + -f 覆盖目标文件之前不提示用户确认
  + -i 与-f相反，提示用户确认
  + -p 保留源文件修改时间和访问权限
  + -l 不复制，创建链接文件
  + -r 递归复制目录下的所有文件和子目录


* 3.9 **mv [option] [original file\|dir] [target file\|dir]** 移动文件、目录或给文件、目录改名
  + -i 覆盖前询问
  + -f 覆盖前不询问
  + -n 不覆盖已存在的文件
  + -u 只有在源文件比目标文件新，或者目标文件不存在时才移动
  + -T 将目标文件当作普通文件处理


* 3.10 **rm [option] [file\|dir]**
  + -f 强制删除
  + -r 递归删除
  + -i 删除前提示确认


* 3.11 **wc [option] [file]** 统计文件行数，单词数，字节数为字符数
  + -l 行数
  + -w 单词数
  + -c 字节数
  + -m 字符数
  + -L 统计文件中最长行的长度


## 四 常用操作命令
### 1. 显示文本内容
  * cat
  * more
  * less
  * head
  * tail


### 2. 处理文本内容
  * **sort [option] [file]** 对文件中的数据进行排序
    + -u 对排序后相同行仅保留其中一行
    + -f 不区别大小写字母
  * **uniq [option] [file]** 删除文件内重复行数据，仅保留唯一样本
    + -c 在每行首加上本行在文本中出现的次数
    + -d 只输出重复的行
    + -D 显示所有重复的行
    + -u 只显示不重复的行
    + -i 不区分大小写字母
    + -s N 跳过前N个字符再比较
    + -f N 跳过前N列
    + -w N 只比较每行前N个字符
  * **cut [option] [file]** 从文件每行中取出选定的字节、字符、字段
    + -b\<list> 只选中列表中指定的字节
    + -c\<list> 只选中列表中指定的字符
    + -c\<分隔符> 按指定的分隔符分隔文件内容
    + -f\<list> 指定文件中设想被分隔符隔开的字段的列表
    + -n 取消分割多字节字符，仅和-b一起使用
    + -s 不打印没有分隔符的行
  * **comm [option] [file1] [file2]** 比较两个已排序的文件
    + -1 不输出文件1特有的行
    + -2 不输出文件2特有的行
    + -3 不输出两个文件共有的行
  * **diff [option] [file1] [file2]** 比较两个文本文件，列出不同之处
    + -b 忽略行尾空格，字符串中不同个数的空格视为相等
    + -r 比较两个目录时，递归比较所有子目录
    + -c 使用上下文输出格式
    + -y 使用并排格式输出
    + -W \<n> 使用并排格式输出时，使用指定的列宽，n为数字
    + -u 使用统一的输出格式
    + -i 忽略大小写
    + -w 忽略所有空白
    + -a 所有文件都视为文本文件逐行比较
    + -B 忽略删除或插入空行引起的变化
    + -q 只比较简短的输出文件是否不同
    + -s 当两个文件相同时报告
    + -t 在输出时扩展tab为空格，保护输入文件的tab对齐方式
    + -x<模式> 排队匹配模式的文件
    + -X<文件> 比较目录时，忽略目录中与任何包含在指定文件的样式相匹配的文件和目录


### 3. 查找文件或命令
  * **grep [option] [pattern] [file]** 查找文件中符合条件的字符串
    + -E 模式为正则表达式
    + -F 模式为由断行符分隔的长字符串
    + -c 只显示匹配行的数量
    + -i 不区分大小写
    + -l 只显示匹配的文件名
    + -L 只显示不匹配的文件名
    + -n 加上匹配行号
    + -v 只显示不包含匹配字符串的行
    + -e\<pattern> 用指定模式来匹配
    + -f\<file> 从文件中取得模式
    + -r 递归读取目录下所有子目录
    + -q 禁止正常输出
    + -s 禁止错误输出
  * **find [path] [option]** 查找路径下符合条件的文件
    + -name 按名称
    + -perm 按权限
    + -user \<usrname> 按用户名
    + group \<gpname> 按用户组名
    + -atime n 按访问时间，过去n天内访问过的
    + -amin n 过去n分钟被访问过的
    + -ctime n 按创建时间，过去n天内
    + -cmin n 过去n分钟内
    + -mtime n 按修改时间，过去n天内
    + -mmin n 过去n分钟内
    + -size n[ckMG] 按大小
    + -empty 查找空文件
    + -type\<文件类型> 按类型查找
      - b 块设备
      - c 字符设备
      - d 目录
      - p 管道文件
      - l 符号链接文件
      - f 普通文件
      - s soket文件
    + -fstype\<文件系统类型> 按文件系统类型查找
    + -nogroup 没有群组的文件
    + -nouser 没有用户的文件
    + -uid\<uid> 按用户id查找
    + -gid\<gid> 按用户组id查找
    + -inum n 按照inode号查找
    + -samefile\<filename> 查找和指定文件inode号相同的文件
    + -readable 匹配只读文件
    + -writable 匹配只写文件
    + -links n 按文件链接数查找文件，n为链接数
  * **locate [option] [file]** 在数据库中查找文件

    显示无法执行命令，找不到文件或目录时，需要先执行updatedb命令手动创建mlocat.db数据库
    +  -q 安静模式，不显示错误信息
    +  -r 使用正则表达式作为搜索条件
    +  -i 忽略大小写
    +  -c 显示找到的数量
    +  -w 匹配完整路径名


### 4. 显示系统信息
  * **uname [option]**
    + -a 显示全部信息
    + -m 硬件架构
    + -n 网络上的主机名
    + -r 操作系统内核号
    + -s 操作系统名称
  * **hostname [option] [主机名\|-F \<文件>]** 显示或修改主机名
    + -s 显示短主机名
    + -i 显示IP地址
    + -f 显示长主机名
    + -d 显示DNS域名
  * **free [option]** 查看内存信息
    + -t 显示内存加上swap总的容量
    + -b/k/m/g 以字节/KB/M/G为单位显示
  * **du [option] [file\|dir]** 显示文件或目录的磁盘占用量
    + -s 只显示总占用量，不显示详细
    + -a 输出所有文件的磁盘占用量，不只是目录
    + -c 显示总计信息
    + -l 如果是硬链接，就多次计算尺寸
    + -x 跳过不同文件系统之上的目录
    + -h 以KB/MB/G等显示
    + -S 不包括子目录
    + -L  找出任何符号链接批示的真正目的地
  * **curl ifconfig.mw** 查找本机公网IP
  * **lspci -tv** 罗列 PCI 设备
  * **lsusb -tv** 显示 USB 设备


### 5. 日期和时间
  * **cal [option] [[[日]月]年]** 显示日历信息
    + -j 显示给定的月份中的每一天是一年当中的第几天
    + -y 显示整年日历
    + -m 以周一为每周第一天的方式显示
    + -s 以周日为每周第一天的方式显示，默认
    + -1 只显示当前月份，默认
    + -3 显示系统前一个月，当前月和下个月的日历
  * **date [option] [pattern]**
    + -d\<字符串> 显示指定字符串描述的时间
    + -s\<字符串> 以指定字符串分开时间
    + -r\<文件> 显示指定文件的最后修改时间
    + -u 输出或者设置通用时间UTC
    + -f\<日期文件>从日期文件中，按行读入时间描述
  * **hwclock** 查看和设置硬件时间


### 6. 系统进程 **ps**命令
  * **ps [option]**
    + 常用指令组合：**ps aux**,然后再通过管道使用**grep**命令过滤查找特定的进程,然后再对特定的进程进行操作
    + a 显示现行终端机下的所有程序，包括其他用户的程序
    + -A/-e 显示所有进程
    + e 列出程序时，显示每个程序所使用的环境变量
    + c 列出程序时，显示每个程序真正的指令名称，而不包含路径，参数或常驻服务的标示
    + f 用ASCII字符显示树状结构，表达程序间的相互关系
    + -H 显示树状结构，表示程序间的相互关系
    + -N 显示所有的程序，除了执行ps指令终端机下的程序之外
    + s 采用程序信号的格式显示程序状况
    + S 列出程序时，包括已中断的子程序资料
    + -t<终端机编号> 指定终端机编号，并列出属于该终端机的程序的状况
    + u 以用户为主的格式来显示程序状况
    + x 显示所有程序，不以终端机来区分


### 7. 信息交流
  * **echo**
  * **mesg [-y/n]** 允许或拒绝网络上主机发消息到本机
  * **wall [消息/文件]** 对全部已登录用户发送消息，消息可包含在文件当中
  * **write [用户] [终端名称]** 向用户发消息，按ctrl+d结束输入


### 8. 其他命令
  * **clear**
  * **uptime** 显示系统已运行时间

    显示下列信息：

    **16:31  up 3 days,  3:28, 6 users, load averages: 1.33 1.39 1.29**

    分别为：当前时间，系统运行了多长时间，目前有多少用户登录，以及过去1min，5min和15min内的平均负载


## 五 Shell 编程
### 1. Shell程序的创建
  * a. 以**#!/bin/bash** 开头，**#** 开头为注释，但**#!**用来告诉系统用何种参数来执行该文件
  * b. **chmod [u]+x [shell程序]** 使文本变成可执行文件，可直接执行，**./[shell程序]**
  * c. 如果不设置可执行文件，则**bash [shell程序]** 也可执行文件

### 2. Shell 变量
引用方法：**$[Shell变量]**
#### 2.1 Shell自定义环境变量
  * HOME 用户主目录完整路径
  * PATH 保存用冒号保存的目录路径，Shell将依次搜索这些目录，找到的第一个命令名称一致的可执行文件将被执行
  * TERM 终端类型
  * UID 当前用户ID
  * PWD 当前目录绝对路径
  * PS1 主提示符
  * PS2 命令没有输入完全，换行继续输入的提示符，默认为'>'


#### 2.2 用户自定义的变量 **变量名=变量值**
  * 限制变量为只读（值不可改变）：**readonly 变量名**
  * 把脚本局部变量变为整个Shell可用：**export 变量名** 或 **export 变量名=变量值**

#### 2.3 位置参数
  * $1,$2,$3...表示程序中第1，2，3...个参数
  * $0 表示程序文件名

#### 2.4 Shell预定义变量
由'$'和另一个符号组成
  * $# 位置参数的数量
  * $* 所有位置参数的内容
  * $? 命令执行后的返回值，0表示没有错误，1表示有错误
  * $$ 当前进程的进程ID
  * $! 后台运行的最后一个进程ID
  * $0 当前执行的进程名

#### 2.5 参数置换的变量
根据指定的位置参数是否已经设置决定变量的取值，有点设置参数默认值的意思
  * 变量=${参数-word} 如果设置了参数，就用参数的值置换变量的值，否则用word置换
  * 变量=${参数=word} 如果设置了参数，就用参数的值置换变量的值，否则把变量设置成word，再用word替换参数的值
  * 变量=${参数?word} 如果设置了参数，就用参数的值置换变量的值，否则就显示word的值并从Shell中退出
  * 变量=${参数+word} 如果设置了参数，就用word置换，否则不进行置换

#### 2.6 变量表达式
  * 字符串比较
    + = 相同为真，不同为假(str1=str2)
    + != 不同为真，相同为假(str1!=str2)
    + -n 判断字符串长度是否为空，空为真，非空为假（-n str1）
    + -z 判断字符串是否为空，空为真，非空为假(-z str1)
